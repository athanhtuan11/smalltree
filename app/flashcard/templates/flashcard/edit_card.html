{% extends "flashcard/base.html" %}

{% block title %}S·ª≠a th·∫ª - {{ deck.title }}{% endblock %}

{% block content %}
<div class="container" style="padding: 40px 20px; max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('flashcard.manage_cards', deck_id=deck.id) }}" class="btn btn-outline-success">
            <i class="bi bi-arrow-left me-2"></i>Quay l·∫°i Qu·∫£n l√Ω th·∫ª
        </a>
    </div>
    
    <div style="background: white; border-radius: 25px; padding: 40px; box-shadow: 0 8px 20px var(--shadow);">
        <h1 style="text-align: center; font-size: 2.5rem; margin-bottom: 10px;">‚úèÔ∏è S·ª≠a th·∫ª</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">B·ªô: {{ deck.title }}</p>
        
        <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="mb-4">
                <label class="form-label" style="font-size: 1.2rem; font-weight: bold;">T·ª´/C·ª•m t·ª´ ch√≠nh *</label>
                <input type="text" name="front_text" class="form-control form-control-lg" value="{{ card.front_text }}" required>
                <small class="text-muted">T·ª´ n√†y s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã v√† ƒë·ªçc cho tr·∫ª nghe</small>
            </div>
            
            <div class="mb-4">
                <label class="form-label" style="font-size: 1.2rem; font-weight: bold;">Gi·∫£i th√≠ch th√™m (t√πy ch·ªçn)</label>
                <input type="text" name="back_text" class="form-control" value="{{ card.back_text or '' }}">
            </div>
            
            <div class="mb-4">
                <label class="form-label" style="font-size: 1.2rem; font-weight: bold;">H√¨nh ·∫£nh hi·ªán t·∫°i</label>
                <div style="margin-bottom: 10px;">
                    <img src="{{ url_for('static', filename=card.image_url) }}" style="max-width: 300px; border-radius: 10px;">
                </div>
                <label class="form-label">Thay ƒë·ªïi h√¨nh ·∫£nh (t√πy ch·ªçn)</label>
                <input type="file" name="image" class="form-control" accept="image/*" id="imageInput">
                <small class="text-muted">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën thay ƒë·ªïi</small>
                <div id="imagePreview" style="margin-top: 15px;"></div>
            </div>
            
            <div class="mb-4">
                <label class="form-label" style="font-size: 1.2rem; font-weight: bold;">Audio hi·ªán t·∫°i</label>
                {% if card.audio_url %}
                <div style="margin-bottom: 10px;">
                    <button type="button" onclick="playAudio('{{ card.audio_url }}')" class="btn btn-sm btn-info">
                        üîä Nghe audio hi·ªán t·∫°i
                    </button>
                </div>
                {% else %}
                <p style="color: #999;">Ch∆∞a c√≥ audio</p>
                {% endif %}
                <label class="form-label">Thay ƒë·ªïi audio (t√πy ch·ªçn)</label>
                <input type="file" name="audio" class="form-control" accept="audio/*" id="audioInput">
                <small class="text-muted">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën thay ƒë·ªïi. N·∫øu kh√¥ng c√≥, h·ªá th·ªëng d√πng TTS</small>
                <div id="audioPreview" style="margin-top: 10px;"></div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button type="submit" class="btn-control btn-finish" style="font-size: 1.3rem; padding: 15px 50px;">
                    ‚úÖ C·∫≠p nh·∫≠t th·∫ª
                </button>
                <a href="{{ url_for('flashcard.manage_cards', deck_id=deck.id) }}" class="btn-control btn-prev" style="font-size: 1.3rem; padding: 15px 50px;">
                    ‚ùå H·ªßy
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Preview h√¨nh ·∫£nh khi ch·ªçn file m·ªõi
document.getElementById('imageInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('imagePreview').innerHTML = `
                <div style="margin-top: 15px;">
                    <strong>H√¨nh m·ªõi:</strong><br>
                    <img src="${e.target.result}" style="max-width: 300px; border-radius: 10px; margin-top: 10px;">
                </div>
            `;
        };
        reader.readAsDataURL(file);
    }
});

// Preview audio khi ch·ªçn file m·ªõi
document.getElementById('audioInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        document.getElementById('audioPreview').innerHTML = `
            <div style="margin-top: 10px;">
                <strong>Audio m·ªõi:</strong> ${file.name}
            </div>
        `;
    }
});
</script>
{% endblock %}
