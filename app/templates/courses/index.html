{% extends 'base.html' %}
{% block content %}
<div class="container-fluid mt-4 mb-4">
    <!-- Header -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <h2 class="fw-bold" style="color:#43a047;">
                <i class="bi bi-mortarboard me-2"></i>
                Khóa học
            </h2>
            <p class="text-muted">Khám phá và học các khóa học chất lượng cao</p>
        </div>
        {% if user_role in ['admin', 'teacher'] %}
        <div class="col-md-4 text-end">
            <a href="{{ url_for('main.course_create') }}" class="btn btn-success">
                <i class="bi bi-plus-circle me-2"></i>Tạo khóa học mới
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body py-2">
            <div class="d-flex gap-2 flex-wrap align-items-center">
                <div class="input-group" style="max-width: 300px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" placeholder="Tìm khóa học...">
                </div>
                <select class="form-select" style="width: auto;">
                    <option>Tất cả danh mục</option>
                    <option>Programming</option>
                    <option>Web Development</option>
                    <option>Data Science</option>
                    <option>Design</option>
                </select>
                <select class="form-select" style="width: auto;">
                    <option>Tất cả level</option>
                    <option>Beginner</option>
                    <option>Intermediate</option>
                    <option>Advanced</option>
                    <option>All Levels</option>
                </select>
                <button class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-funnel me-1"></i>Thêm filters
                </button>
            </div>
        </div>
    </div>

    <!-- Courses Grid -->
    <div class="row">
        {% if courses %}
            {% for course in courses %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 course-card">
                    <div class="position-relative">
                        {% if course.thumbnail %}
                        <img src="{{ course.thumbnail }}" class="card-img-top" alt="{{ course.title }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="bi bi-play-circle" style="font-size: 4rem; color: #43a047;"></i>
                        </div>
                        {% endif %}
                        <span class="badge bg-dark position-absolute top-0 end-0 m-2">
                            {{ course.level or 'All Levels' }}
                        </span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title course-title">{{ course.title }}</h5>
                        <p class="text-muted small mb-2">{{ course.instructor.name if course.instructor else 'Unknown' }}</p>
                        <p class="card-text text-muted small">{{ (course.short_description or course.description or '')[:100] }}{% if course.description and course.description|length > 100 %}...{% endif %}</p>
                        
                        <div class="d-flex align-items-center mb-2">
                            <span class="text-warning me-1">
                                <strong>{{ "%.1f"|format(course.rating_avg or 0) }}</strong>
                            </span>
                            {% for i in range(5) %}
                                {% if i < (course.rating_avg or 0)|int %}
                                <i class="bi bi-star-fill text-warning"></i>
                                {% else %}
                                <i class="bi bi-star text-warning"></i>
                                {% endif %}
                            {% endfor %}
                            <span class="text-muted small ms-2">({{ course.rating_count or 0 }})</span>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted small">
                                <i class="bi bi-people me-1"></i>{{ course.enrolled_count or 0 }} students
                            </span>
                            <span class="text-muted small">
                                <i class="bi bi-clock me-1"></i>{{ (course.total_duration or 0) // 60 }}h {{ (course.total_duration or 0) % 60 }}m
                            </span>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                {% if course.price > 0 %}
                                <span class="h5 mb-0 text-success">{{ "{:,.0f}".format(course.price) }}đ</span>
                                {% else %}
                                <span class="h5 mb-0 text-success">Miễn phí</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pt-0">
                        <a href="{{ url_for('main.course_detail', course_id=course.id) }}" class="btn btn-outline-success w-100">
                            <i class="bi bi-eye me-2"></i>Xem chi tiết
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="bi bi-journal-x" style="font-size: 4rem; color: #6c757d;"></i>
                <h4 class="mt-3">Chưa có khóa học nào</h4>
                <p class="text-muted">Hệ thống đang phát triển. Các khóa học sẽ sớm có mặt!</p>
                {% if user_role in ['admin', 'teacher'] %}
                <a href="{{ url_for('main.course_create') }}" class="btn btn-success mt-3">
                    <i class="bi bi-plus-circle me-2"></i>Tạo khóa học đầu tiên
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
.course-card {
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
}

.course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.course-title {
    font-size: 1.1rem;
    line-height: 1.3;
    min-height: 2.6rem;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}
</style>
{% endblock %}
